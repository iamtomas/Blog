## Docker

### 介绍

Docker 即容器化技术，能够在称为容器的松散隔离环境中包装和运行应用程序

### 概念

![docker-img1](../docker-img.png)

### 实践

在[play-with-docker](/labs.play-with-docker.com)中实践，首先创建一个 nginx 服务器为例：

1、从仓库中拉取 nginx 镜像

```bash
# 默认是拉取最新版本，即 nginx:latest
docker pull nginx
```

2、查看本地的镜像

```bash
docker images
```

3、运行 nginx

```bash
# -d：后台运行不要阻塞shell指令窗口；-p：制定内外端口映射，-v：映射文件，比如将当前目录映射到内部某路径下/use/share/nginx/html/，这时可以将静态文件放在外边，修改时里面的文件也跟着修改
docker run -d -p 80:80 nginx # 返回容器id
docker run -d -p 81:80 nginx # 设置对外端口为81
```

4、修改 nginx

```bash
# 进入 nginx 容器 bash
docker exec -it [容器id](可以为id的前几位) bash
# index.html 一般在/use/share/nginx/html/
cd /use/share/nginx/html/ && echo hello > index.html
```

5、删除容器

```bash
docker rm -f [容器id](可以为id的前几位)
```

6、commit 保存镜像到本地

```bash
docker commit [容器id](可以为id的前几位) [自定义镜像名]
docker images # 本地可以查看到
docker run -d -p 82:80 [自定义镜像名]
```

7、编写 Dockerfile 构建镜像

```bash
Dockerfile：
	FROM nginx # 指定 docker构建的镜像
	ADD ./ /usr/share/nginx/html/ # 将当前目录下所有文件拷贝到 html 文件夹下
	
# 保存 dockerfile 文件后创建并编辑 index.html

# 当前目录下的 Dockerfile 去构建
docker build -t [自定义镜像名] . 
docker run -d -p 100:80 [自定义镜像名]
docker ps
```

8、将镜像保存到 .tar 文件，先删除镜像，后通过 load 命令加载回来

```bash
docker save [镜像名] > test.tar
# 删除镜像失败时，很可能是有容器正在使用这个镜像，可以通过 `docker rm -f [容器id](可以为id的前几位)
docker rmi [镜像名] 
# 可以看到镜像被删除了
docker images 
# 加载 test.tar 回恢复镜像
docker load < test.tar
```

