## 1) 乐观锁和悲观锁

**乐观锁**

定义：在操作数据时比较乐观，认为别人不会不会同时修改数据，只是在更新时判断这期间有没人修改，如果有，则放弃继续操作

实现方式：**CAS** 或 **版本号**

CAS (Compare And Swap) 

主要有三部分：1）需要读写的内存位置  2）预期值  3）写入的新值

CAS 原理：如果内存位置的值等于预期的值，则将该位置更新为新值，否则不进行任何操作。许多CAS的操作是自旋的：如果操作不成功，会一直重试，直到操作成功为止。

注：CAS是由CPU支持的原子操作，其原子性是在硬件层面进行保证的。

**悲观锁**

定义：在操作数据时比较悲观，认为别人会同时修改数据，因此操作数据时直接给数据锁住，直到操作完成后才释放


**实践**

可通过 **开启1000个线程来实现自增的方式** 比较 乐观锁(CAS) 和 悲观锁 以及 没进行任何线程安全方面保护的对象，会发现除了 乐观锁 和 悲观锁 没问题，其他的偏少

**优缺点和适用场景**

- 乐观锁适用的场景受到了更多的限制（如CAS只能保证**单个**变量操作的原子性，版本号不能解决多表的情况）
- 竞争不激烈，乐观锁更有优势，因为悲观锁会锁住代码块或数据，其他线程无法同时访问，影响并发，而且加锁和释放锁都需要消耗额外的资源；竞争激烈时，乐观锁在执行更新时频繁失败，需要不断重试，浪费CPU资源

**拓展**

CAS有哪些缺点

- ABA问题
- 高竞争下的开销问题（频繁重试）
- 功能限制（只能保证单个变量操作的原子性）

参考：https://www.cnblogs.com/kismetv/p/10787228.html
